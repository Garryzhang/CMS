var AjaxMonitor,Bar,DocumentMonitor,ElementMonitor,ElementTracker,EventLagMonitor,Events,NoTargetError,RequestIntercept,SOURCE_KEYS,Scaler,SocketRequestTracker,XHRRequestTracker,animation,avgAmplitude,bar,cancelAnimation,cancelAnimationFrame,defaultOptions,extend,extendNative,getFromDOM,getIntercept,handlePushState,init,now,options,requestAnimationFrame,result,runAnimation,scalers,sources,uniScaler,_WebSocket,_XDomainRequest,_XMLHttpRequest,_intercept,_pushState,_ref,_replaceState,__slice=[].slice,__hasProp={}.hasOwnProperty,__extends=function(n,t){function r(){this.constructor=n}for(var i in t)__hasProp.call(t,i)&&(n[i]=t[i]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},__indexOf=[].indexOf||function(n){for(var t=0,i=this.length;t<i;t++)if(t in this&&this[t]===n)return t;return-1};if(defaultOptions={catchupTime:500,initialRate:.03,minTime:500,ghostTime:250,maxProgressPerFrame:10,easeFactor:1.25,startOnPageLoad:!0,restartOnPushState:!0,restartOnRequestAfter:500,target:"body",elements:{checkInterval:100,selectors:["body"]},eventLag:{minSamples:10,sampleCount:3,lagThreshold:3},ajax:{trackMethods:["GET"],trackWebSockets:!1}},now=function(){var n;return(n=typeof performance!="undefined"&&performance!==null?typeof performance.now=="function"?performance.now():void 0:void 0)!=null?n:+new Date},requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame,cancelAnimationFrame=window.cancelAnimationFrame||window.mozCancelAnimationFrame,requestAnimationFrame!=null||(requestAnimationFrame=function(n){return setTimeout(n,50)},cancelAnimationFrame=function(n){return clearTimeout(n)}),runAnimation=function(n){var t,i;return t=now(),i=function(){var r;return r=now()-t,t=now(),n(r,function(){return requestAnimationFrame(i)})},i()},result=function(){var i,t,n;return n=arguments[0],t=arguments[1],i=3<=arguments.length?__slice.call(arguments,2):[],typeof n[t]=="function"?n[t].apply(n,i):n[t]},extend=function(){var n,t,i,f,r,u,e;for(t=arguments[0],f=2<=arguments.length?__slice.call(arguments,1):[],u=0,e=f.length;u<e;u++)if(i=f[u],i)for(n in i)__hasProp.call(i,n)&&(r=i[n],t[n]!=null&&typeof t[n]=="object"&&r!=null&&typeof r=="object"?extend(t[n],r):t[n]=r);return t},avgAmplitude=function(n){var i,r,u,t,f;for(r=i=0,t=0,f=n.length;t<f;t++)u=n[t],r+=Math.abs(u),i++;return r/i},getFromDOM=function(n,t){var i,r;if(n==null&&(n="options"),t==null&&(t=!0),r=document.querySelector("[data-pace-"+n+"]"),r){if(i=r.getAttribute("data-pace-"+n),!t)return i;try{return JSON.parse(i)}catch(u){return typeof console!="undefined"&&console!==null?console.error("Error parsing inline pace options",u):void 0}}},(_ref=window.Pace)==null&&(window.Pace={}),options=Pace.options=extend(defaultOptions,window.paceOptions,getFromDOM()),NoTargetError=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,n),t}(Error),Bar=function(){function n(){this.progress=0}return n.prototype.getElement=function(){var n;if(!(this.el!=null)){if(n=document.querySelector(options.target),!n)throw new NoTargetError;this.el=document.createElement("div"),this.el.className="pace pace-active",this.el.innerHTML='<div class="pace-progress">\n  <div class="pace-progress-inner"><\/div>\n<\/div>\n<div class="pace-activity"><\/div>',n.firstChild!=null?n.insertBefore(this.el,n.firstChild):n.appendChild(this.el),options.start&&typeof options.start=="function"&&options.start()}return this.el},n.prototype.finish=function(){var n;return n=this.getElement(),n.className=n.className.replace("pace-active",""),n.className+=" pace-inactive",options.stop&&typeof options.stop=="function"?options.stop():void 0},n.prototype.update=function(n){return this.progress=n,this.render()},n.prototype.destroy=function(){return this.getElement().parentNode.removeChild(this.getElement()),this.el=void 0},n.prototype.render=function(){var n,t;return(document.querySelector(options.target)!=null)?(n=this.getElement(),n.children[0].style.width=""+this.progress+"%",(!this.lastRenderedProgress||this.lastRenderedProgress|0!==this.progress|0)&&(n.children[0].setAttribute("data-progress-text",""+(this.progress|0)+"%"),t=this.progress>=100?"99":(this.progress<10?"0":"")+(this.progress|0),n.children[0].setAttribute("data-progress",""+t)),this.lastRenderedProgress=this.progress):!1},n.prototype.done=function(){return this.progress>=100},n}(),Events=function(){function n(){this.bindings={}}return n.prototype.trigger=function(n,t){var f,i,e,r,u;if(this.bindings[n]!=null){for(r=this.bindings[n],u=[],i=0,e=r.length;i<e;i++)f=r[i],u.push(f.call(this,t));return u}},n.prototype.on=function(n,t){var i,r;return(r=(i=this.bindings)[n])==null&&(i[n]=[]),this.bindings[n].push(t)},n}(),_XMLHttpRequest=window.XMLHttpRequest,_XDomainRequest=window.XDomainRequest,_WebSocket=window.WebSocket,extendNative=function(n,t){var i,r,u=[];for(i in t.prototype)try{r=t.prototype[i],n[i]!=null||typeof r=="function"?u.push(void 0):u.push(n[i]=r)}catch(f){}return u},RequestIntercept=function(n){function t(){var n,i=this;t.__super__.constructor.apply(this,arguments),n=function(n){var t;return t=n.open,n.open=function(r,u){var f;return(f=(r!=null?r:"GET").toUpperCase(),__indexOf.call(options.ajax.trackMethods,f)>=0)&&i.trigger("request",{type:r,url:u,request:n}),t.apply(n,arguments)}},window.XMLHttpRequest=function(t){var i;return i=new _XMLHttpRequest(t),n(i),i},extendNative(window.XMLHttpRequest,_XMLHttpRequest),_XDomainRequest!=null&&(window.XDomainRequest=function(){var t;return t=new _XDomainRequest,n(t),t},extendNative(window.XDomainRequest,_XDomainRequest)),_WebSocket!=null&&options.ajax.trackWebSockets&&(window.WebSocket=function(n,t){var r;return r=new _WebSocket(n,t),i.trigger("request",{type:"socket",url:n,protocols:t,request:r}),r},extendNative(window.WebSocket,_WebSocket))}return __extends(t,n),t}(Events),_intercept=null,getIntercept=function(){return _intercept!=null||(_intercept=new RequestIntercept),_intercept},options.restartOnRequestAfter!==!1)getIntercept().on("request",function(n){var i,t,r;return r=n.type,t=n.request,Pace.running?void 0:(i=arguments,setTimeout(function(){var n,o,u,s,h,f,e;if(o=r==="socket"?t.readyState<2:0<(h=t.readyState)&&h<4,o){for(Pace.restart(),f=Pace.sources,e=[],u=0,s=f.length;u<s;u++)if(n=f[u],n instanceof AjaxMonitor){n.watch.apply(n,i);break}else e.push(void 0);return e}},options.restartOnRequestAfter))});AjaxMonitor=function(){function n(){var n=this;this.elements=[];getIntercept().on("request",function(){return n.watch.apply(n,arguments)})}return n.prototype.watch=function(n){var t,i,r;return r=n.type,t=n.request,i=r==="socket"?new SocketRequestTracker(t):new XHRRequestTracker(t),this.elements.push(i)},n}(),XHRRequestTracker=function(){function n(n){var f,o,i,e,r,u,t=this;if(this.progress=0,window.ProgressEvent!=null)for(o=null,n.addEventListener("progress",function(n){return t.progress=n.lengthComputable?100*n.loaded/n.total:t.progress+(100-t.progress)/2}),u=["load","abort","timeout","error"],i=0,e=u.length;i<e;i++)f=u[i],n.addEventListener(f,function(){return t.progress=100});else r=n.onreadystatechange,n.onreadystatechange=function(){var i;return(i=n.readyState)===0||i===4?t.progress=100:n.readyState===3&&(t.progress=50),typeof r=="function"?r.apply(null,arguments):void 0}}return n}(),SocketRequestTracker=function(){function n(n){var r,t,u,i,f=this;for(this.progress=0,i=["error","open"],t=0,u=i.length;t<u;t++)r=i[t],n.addEventListener(r,function(){return f.progress=100})}return n}(),ElementMonitor=function(){function n(n){var r,t,u,f,i;for(n==null&&(n={}),this.elements=[],(f=n.selectors)==null&&(n.selectors=[]),i=n.selectors,t=0,u=i.length;t<u;t++)r=i[t],this.elements.push(new ElementTracker(r))}return n}(),ElementTracker=function(){function n(n){this.selector=n,this.progress=0,this.check()}return n.prototype.check=function(){var n=this;return document.querySelector(this.selector)?this.done():setTimeout(function(){return n.check()},options.elements.checkInterval)},n.prototype.done=function(){return this.progress=100},n}(),DocumentMonitor=function(){function n(){var n,i,t=this;this.progress=(i=this.states[document.readyState])!=null?i:100,n=document.onreadystatechange,document.onreadystatechange=function(){return t.states[document.readyState]!=null&&(t.progress=t.states[document.readyState]),typeof n=="function"?n.apply(null,arguments):void 0}}return n.prototype.states={loading:0,interactive:50,complete:100},n}(),EventLagMonitor=function(){function n(){var t,r,i,u,n,f=this;this.progress=0,t=0,n=[],u=0,i=now(),r=setInterval(function(){var e;return e=now()-i-50,i=now(),n.push(e),n.length>options.eventLag.sampleCount&&n.shift(),t=avgAmplitude(n),++u>=options.eventLag.minSamples&&t<options.eventLag.lagThreshold?(f.progress=100,clearInterval(r)):f.progress=300/(t+3)},50)}return n}(),Scaler=function(){function n(n){this.source=n,this.last=this.sinceLastUpdate=0,this.rate=options.initialRate,this.catchup=0,this.progress=this.lastProgress=0,this.source!=null&&(this.progress=result(this.source,"progress"))}return n.prototype.tick=function(n,t){var i;return t==null&&(t=result(this.source,"progress")),t>=100&&(this.done=!0),t===this.last?this.sinceLastUpdate+=n:(this.sinceLastUpdate&&(this.rate=(t-this.last)/this.sinceLastUpdate),this.catchup=(t-this.progress)/options.catchupTime,this.sinceLastUpdate=0,this.last=t),t>this.progress&&(this.progress+=this.catchup*n),i=1-Math.pow(this.progress/100,options.easeFactor),this.progress+=i*this.rate*n,this.progress=Math.min(this.lastProgress+options.maxProgressPerFrame,this.progress),this.progress=Math.max(0,this.progress),this.progress=Math.min(100,this.progress),this.lastProgress=this.progress,this.progress},n}(),sources=null,scalers=null,bar=null,uniScaler=null,animation=null,cancelAnimation=null,Pace.running=!1,handlePushState=function(){if(options.restartOnPushState)return Pace.restart()},window.history.pushState!=null&&(_pushState=window.history.pushState,window.history.pushState=function(){return handlePushState(),_pushState.apply(window.history,arguments)}),window.history.replaceState!=null&&(_replaceState=window.history.replaceState,window.history.replaceState=function(){return handlePushState(),_replaceState.apply(window.history,arguments)}),SOURCE_KEYS={ajax:AjaxMonitor,elements:ElementMonitor,document:DocumentMonitor,eventLag:EventLagMonitor},(init=function(){var f,n,t,i,e,o,r,s,u;for(Pace.sources=sources=[],r=["ajax","elements","document","eventLag"],t=0,e=r.length;t<e;t++)n=r[t],options[n]!==!1&&sources.push(new SOURCE_KEYS[n](options[n]));for(u=(s=options.extraSources)!=null?s:[],i=0,o=u.length;i<o;i++)f=u[i],sources.push(new f(options));return Pace.bar=bar=new Bar,scalers=[],uniScaler=new Scaler})(),Pace.stop=function(){return Pace.running=!1,bar.destroy(),cancelAnimation=!0,animation!=null&&(typeof cancelAnimationFrame=="function"&&cancelAnimationFrame(animation),animation=null),init()},Pace.restart=function(){return Pace.stop(),Pace.go()},Pace.go=function(){return Pace.running=!0,bar.render(),cancelAnimation=!1,animation=runAnimation(function(n,t){var v,f,e,y,o,i,r,nt,u,s,h,p,c,l,a,w,b,k,d,g;for(nt=100-bar.progress,f=c=0,e=!0,i=l=0,w=sources.length;l<w;i=++l)for(h=sources[i],s=(k=scalers[i])!=null?k:scalers[i]=[],o=(d=h.elements)!=null?d:[h],r=a=0,b=o.length;a<b;r=++a)(y=o[r],u=(g=s[r])!=null?g:s[r]=new Scaler(y),e&=u.done,u.done)||(f++,c+=u.tick(n));return v=c/f,bar.update(uniScaler.tick(n,v)),p=now(),bar.done()||e||cancelAnimation?(bar.update(100),setTimeout(function(){return bar.finish(),Pace.running=!1},Math.max(options.ghostTime,Math.min(options.minTime,now()-p)))):t()})},Pace.start=function(n){extend(options,n),Pace.running=!0;try{bar.render()}catch(t){}return document.querySelector(".pace")?Pace.go():setTimeout(Pace.start,50)},typeof define=="function"&&define.amd?define(function(){return Pace}):typeof exports=="object"?module.exports=Pace:options.startOnPageLoad&&Pace.start()