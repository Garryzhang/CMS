angular.module("admin-gallery-edit",["resource.galleries","resource.photos"]).config(["$routeProvider",function(n){return n.when("/admin/gallery(':id')",{templateUrl:"/content/app-admin/gallery/edit/gallery-edit.tpl.html",controller:"GalleryEditCtrl"}).when("/admin/gallery/new",{templateUrl:"/content/app-admin/gallery/edit/gallery-edit.tpl.html",controller:"GalleryEditCtrl"})}]).controller("GalleryEditCtrl",["$scope","$routeParams","$location","$rootScope","uploadManager","Gallery","Photo",function(n,t,i,r,u,f,e){var o;return n.get=function(){return t.id?f.get({$filter:"GalleryId eq (guid'"+t.id+"')",$expand:"Photos"},function(t){return n.entity=t.value[0],uploadInit("/FileManage/Photo/"+n.entity.GalleryId),galleryInit()}):n.entity={}},n.submit=function(){return(n.isSubmit=!0,!n.entity.Name)?!1:n.files.length?u.upload():o()},o=function(){var r;return r=n.entity,t.id||(r.GalleryId=UUID.generate()),f.update({id:"(guid'"+r.GalleryId+"')"},r,function(){return message.success("Save category successfully."),r.CreateDate?(n.get(),n.files=[]):i.path("/admin/gallery('"+r.GalleryId+"')")})},n.files=[],n.removeImg=function(t){var e,r,i,o,f;for(f=n.files,i=0,o=f.length;i<o;i++)r=f[i],r.name===t.name&&(e=r);return n.files.splice(n.files.indexOf(e),1),u.cancel(t)},n.removeServerImg=function(){return n.entity.Cover=void 0},r.$on("fileAdded",function(t,i){return n.files.push(i),n.$apply()}),r.$on("fileUploaded",function(t,i){if(!n.entity.Cover)return n.entity.Cover=i.result,o()}),n.removePhoto=function(t){return message.confirm(function(){return n.loading="Delete",t.IsDeleted=!0,e.update({id:"(guid'"+t.PhotoId+"')"},t,function(){return message.success("Delete successfully."),n.loading="",n.get()})})},n.get()}])