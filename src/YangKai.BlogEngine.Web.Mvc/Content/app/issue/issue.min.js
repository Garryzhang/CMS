angular.module("issue",["resource.issues"]).filter("filterByDate",function(){return function(n,t){var i,r,u,f;if(!n)return n;for(r=[],u=0,f=n.length;u<f;u++)i=n[u],t===""&&r.push(i),t==="day"&&moment(new Date).format("YYYY-MM-DD")===moment(i.CreateDate).format("YYYY-MM-DD")&&r.push(i),t==="week"&&moment(new Date).diff(i.CreateDate,"days")<=7&&r.push(i),t==="month"&&moment(new Date).diff(i.CreateDate,"days")<=30&&r.push(i);return r}}).config(["$routeProvider",function(n){return n.when("/issue",{templateUrl:"/content/app/issue/issue.tpl.html",controller:"IssueCtrl",title:"Issues"})}]).controller("IssueCtrl",["$scope","$translate","$routeParams","$location","Issue",function(n,t,i,r,u){return n.$parent.showBanner=!1,n.projects=["API Portal","API Framework","ServiceStack.Text","Framework API/ API SDK","Oversea WCF Framework","Framework Tools","Auth Service","Gateway","Oversea Data Access","Cassandra Adapter","Document Tool","Common API","API Notify","Newegg Central Framework","HR Tools"].sort(),n.get=function(){return n.loading=t("global.loading"),u.query(function(t){return n.list=t.value,n.setGroup(),n.loading=""})},n.setGroup=function(){var u,t,f,r,i,v,e,o,s,y,p,w,c,l,a,h;for(i={},r={},u={},n.count={statu:0,project:0,date:0},i.Open=0,i.Closed=0,i.Cancel=0,c=n.list,e=0,y=c.length;e<y;e++)t=c[e],(n.filter.Project===""||t.Project===n.filter.Project)&&(n.filterDate===""&&(i[t.Statu]||(i[t.Statu]=0),i[t.Statu]++,n.count.statu++),n.filterDate==="day"&&moment(new Date).format("YYYY-MM-DD")===moment(t.CreateDate).format("YYYY-MM-DD")&&(i[t.Statu]||(i[t.Statu]=0),i[t.Statu]++,n.count.statu++),n.filterDate==="week"&&moment(new Date).diff(t.CreateDate,"days")<=7&&(i[t.Statu]||(i[t.Statu]=0),i[t.Statu]++,n.count.statu++),n.filterDate==="month"&&moment(new Date).diff(t.CreateDate,"days")<=30&&(i[t.Statu]||(i[t.Statu]=0),i[t.Statu]++,n.count.statu++));for(l=n.list,o=0,p=l.length;o<p;o++)t=l[o],(n.filter.Statu===""||t.Statu===n.filter.Statu)&&(n.filterDate===""&&(r[t.Project]||(r[t.Project]=0),r[t.Project]++,n.count.project++),n.filterDate==="day"&&moment(new Date).format("YYYY-MM-DD")===moment(t.CreateDate).format("YYYY-MM-DD")&&(r[t.Project]||(r[t.Project]=0),r[t.Project]++,n.count.project++),n.filterDate==="week"&&moment(new Date).diff(t.CreateDate,"days")<=7&&(r[t.Project]||(r[t.Project]=0),r[t.Project]++,n.count.project++),n.filterDate==="month"&&moment(new Date).diff(t.CreateDate,"days")<=30&&(r[t.Project]||(r[t.Project]=0),r[t.Project]++,n.count.project++));for(u.day=0,u.week=0,u.month=0,a=n.list,s=0,w=a.length;s<w;s++)t=a[s],(n.filter.Statu===""||t.Statu===n.filter.Statu)&&(n.filter.Project===""||t.Project===n.filter.Project)&&(moment(t.CreateDate).format("YYYY-MM-DD")===moment(new Date).format("YYYY-MM-DD")&&u.day++,moment(new Date).diff(t.CreateDate,"days")<=7&&u.week++,moment(new Date).diff(t.CreateDate,"days")<=30&&u.month++,n.count.date++);n.statu=i;n.date=u;n.project=[];h=[];for(f in r)v=r[f],r.hasOwnProperty(f)?h.push(n.project.push({key:f,value:v})):h.push(void 0);return h},n.add=function(){return n.entity={},n.editDialog=!0},n.save=function(){var i;return n.loading=t("global.post"),i=n.entity,i.IssueId=UUID.generate(),i.Statu="Open",u.update({id:"(guid'"+i.IssueId+"')"},i,function(){return message.success("Create issue successfully."),n.editDialog=!1,n.loading="",n.get()})},n.edit=function(n){return n.show=!0,n.edit=!n.edit,n.title=n.Title,n.content=n.Content,n.result=n.Result,n.statu=n.Statu},n.handle=function(t){var i;return t.Title=t.title,t.Content=t.content,t.Result=t.result,t.Statu=t.statu,n.loading="save",i=angular.copy(t),delete i.edit,delete i.show,delete i.date,delete i.title,delete i.content,delete i.result,delete i.statu,u.update({id:"(guid'"+i.IssueId+"')"},i,function(){return message.success("Save issue successfully."),n.editDialog=!1,n.loading="",n.get()})},n.get()}])